<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Flood Detector Project</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0; padding: 0;
      background: #f4f4f9;
      color: #333;
      scroll-behavior: smooth;
    }
    header {
      background: linear-gradient(135deg,#0066b3 0%,#0088dd 100%);
      color: white;
      padding: 28px 20px;
      text-align: center;
      box-shadow: 0 6px 18px rgba(0,0,0,0.08);
      animation: slideDown 0.6s ease-out;
    }
    @keyframes slideDown {
      from { transform: translateY(-100%); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    section {
      padding: 40px;
      max-width: 900px;
      margin: auto;
      animation: fadeInUp 0.7s ease-out forwards;
      opacity: 0;
    }
    section:nth-child(1) { animation-delay: 0.1s; }
    section:nth-child(2) { animation-delay: 0.2s; }
    section:nth-child(3) { animation-delay: 0.3s; }
    section:nth-child(4) { animation-delay: 0.4s; }
    section:nth-child(5) { animation-delay: 0.5s; }
    section:nth-child(6) { animation-delay: 0.6s; }
    section:nth-child(7) { animation-delay: 0.7s; }
    section:nth-child(8) { animation-delay: 0.8s; }
    @keyframes fadeInUp {
      from { transform: translateY(30px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    .hero-card {
      display: flex;
      gap: 24px;
      align-items: center;
      background: linear-gradient(180deg, rgba(255,255,255,0.9), rgba(250,250,255,0.95));
      border-radius: 12px;
      padding: 18px;
      box-shadow: 0 8px 20px rgba(18,63,88,0.06);
      margin-top: -30px;
      transform: translateY(-10px);
      animation: popIn 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    @keyframes popIn {
      from { transform: translateY(-10px) scale(0.95); opacity: 0; }
      to { transform: translateY(-10px) scale(1); opacity: 1; }
    }
    .hero-left { flex: 1 1 360px; }
    .hero-right { width: 320px; flex: 0 0 320px; }
    h2 {
      color: #0077cc;
    }
    pre {
      background: #222;
      color: #eee;
      padding: 20px;
      overflow-x: auto;
      border-radius: 8px;
      font-size: 14px;
      line-height: 1.4em;
    }
    /* Water gauge styles */
    .gauge {
      --level: 30%; /* default */
      position: relative;
      width: 240px;
      height: 220px;
      background: linear-gradient(#e6f7ff,#fff);
      border-radius: 12px;
      overflow: hidden;
      border: 1px solid rgba(0,0,0,0.06);
      box-shadow: 0 6px 18px rgba(3,44,77,0.05) inset;
      transition: box-shadow 0.4s ease;
    }
    .gauge:hover {
      box-shadow: 0 8px 24px rgba(3,44,77,0.12) inset;
    }
    .gauge .water {
      position: absolute;
      left: 0; right: 0; bottom: 0;
      height: var(--level);
      background: radial-gradient(circle at 50% 30%, rgba(255,255,255,0.35), rgba(255,255,255,0.08)), linear-gradient(180deg,#00aaff,#006bb3);
      transition: height 800ms cubic-bezier(.2,.9,.2,1);
      display: flex; align-items: center; justify-content: center;
      color: rgba(255,255,255,0.95);
      font-weight: 700;
      font-size: 22px;
    }
    .gauge .water::before,
    .gauge .water::after {
      content: '';
      position: absolute;
      left: -40%;
      width: 200%; height: 60px;
      background: rgba(255,255,255,0.06);
      border-radius: 50%;
      transform: translateY(-20%) rotate(0deg);
      animation: wave 4s linear infinite;
      opacity: 0.35;
    }
    .gauge .water::after { animation-duration: 6s; opacity: 0.22; }
    @keyframes wave { from { transform: translateX(-50%) translateY(-20%) rotate(0deg); } to { transform: translateX(50%) translateY(-20%) rotate(0deg); } }
    .gauge .label { position: absolute; top: 12px; left: 12px; color: #004d66; font-weight:700; }
    .status { display:flex; gap:10px; align-items:center; }
    .status .dot { width:12px; height:12px; border-radius:50%; background:#2db34a; box-shadow: 0 2px 6px rgba(45,179,74,0.18); }
    .status.alert .dot { background: #ff3b30; box-shadow: 0 6px 18px rgba(255,59,48,0.18); animation: pulse 1.2s infinite; }
    @keyframes pulse { 0%{ transform: scale(1);}50%{ transform: scale(1.18);}100%{ transform: scale(1);} }
    .features {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
    }
    .feature {
      flex: 1 1 250px;
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .feature:hover {
      transform: translateY(-6px);
      box-shadow: 0 12px 24px rgba(0,0,0,0.12);
    }
    footer {
      background: #0077cc;
      color: white;
      text-align: center;
      padding: 15px;
      margin-top: 40px;
    }
    a {
      color: #0077cc;
      text-decoration: none;
      transition: color 0.2s ease;
    }
    a:hover {
      color: #0055aa;
      text-decoration: underline;
    }
    img {
      max-width: 100%;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      margin-top: 15px;
    }
    /* New UI improvements */
    .btn {
      display:inline-flex;align-items:center;gap:8px;
      padding:8px 12px;border-radius:10px;border:0;cursor:pointer;
      background:#0077cc;color:#fff;font-weight:600;
      box-shadow:0 6px 18px rgba(3,44,77,0.08);
      transition:transform .12s ease,box-shadow .12s ease,opacity .12s;
    }
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 24px rgba(3,44,77,0.15);
    }
    .btn:active { transform: translateY(0px); }
    .download-grid { display:flex;gap:14px;flex-wrap:wrap;margin-top:12px; }
    .download-card {
      background:#fff;padding:14px;border-radius:10px;box-shadow:0 6px 18px rgba(18,63,88,0.04);
      min-width:220px;flex:1 1 260px;display:flex;align-items:center;gap:12px;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .download-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 28px rgba(18,63,88,0.12);
    }
    .file-meta { flex:1; }
    .file-name { font-weight:700;color:#033e5a;margin-bottom:6px;font-size:14px; }
    .file-desc { font-size:13px;color:#556068;margin-bottom:8px; }
    .badge { display:inline-block;font-size:11px;padding:4px 8px;border-radius:999px;background:#e6f7ff;color:#006fb3;font-weight:700;margin-left:8px; }
    .dl-actions { display:flex;gap:8px;align-items:center; }
    .tiny { font-size:12px;color:#77838a; }
    /* gauge color variants */
    .gauge.alert .water { background: linear-gradient(180deg,#ff6b5f,#d94b3d); }
    .gauge.high .water { background: linear-gradient(180deg,#ffd166,#ff8a00); color:#05314a; }
    /* subtle hover for images */
    figure img:hover { transform:translateY(-4px); transition:transform .18s ease; }

    /* Responsive & Mobile-Friendly Styles */
    @media (max-width: 768px) {
      header {
        padding: 20px 16px;
      }
      header h1 {
        font-size: 24px;
        margin: 0;
      }
      header p {
        font-size: 14px;
        margin: 8px 0 0 0;
      }
      section {
        padding: 24px 16px;
        max-width: 100%;
      }
      .container {
        max-width: 100%;
        margin: 20px auto;
        padding: 0 16px;
      }
      .hero-card {
        flex-direction: column;
        gap: 16px;
        padding: 16px;
        margin-top: -20px;
      }
      .hero-left { flex: 1 1 100%; }
      .hero-right { width: 100%; flex: 0 0 100%; }
      .gauge {
        width: 100%;
        max-width: 280px;
        height: 240px;
        margin: 0 auto;
      }
      h2 {
        font-size: 22px;
        margin-top: 0;
      }
      h3 {
        font-size: 18px;
      }
      pre {
        font-size: 12px;
        padding: 16px;
        line-height: 1.3em;
      }
      .download-grid {
        flex-direction: column;
        gap: 12px;
      }
      .download-card {
        flex-direction: column;
        align-items: flex-start;
        min-width: 100%;
        padding: 12px;
      }
      .file-meta { flex: 1; width: 100%; }
      .dl-actions { width: 100%; }
      .dl-actions .btn {
        width: 100%;
        justify-content: center;
      }
      .features {
        flex-direction: column;
        gap: 16px;
      }
      .feature {
        flex: 1 1 100%;
        padding: 16px;
      }
      .feature h3 {
        font-size: 16px;
        margin: 0 0 8px 0;
      }
      .feature p {
        font-size: 14px;
        margin: 0;
      }
      .btn {
        padding: 10px 14px;
        font-size: 14px;
        width: auto;
      }
      .btn:hover {
        transform: translateY(-1px);
      }
      figure {
        max-width: 100%;
      }
      figure img {
        max-width: 100%;
      }
      ul, ol {
        padding-left: 20px;
        font-size: 14px;
      }
      li {
        margin-bottom: 8px;
        line-height: 1.5;
      }
    }

    @media (max-width: 480px) {
      header {
        padding: 16px 12px;
      }
      header h1 {
        font-size: 20px;
      }
      header p {
        font-size: 12px;
      }
      section {
        padding: 16px 12px;
      }
      .container {
        padding: 0 12px;
      }
      h2 {
        font-size: 20px;
      }
      h3 {
        font-size: 16px;
      }
      .gauge {
        width: 100%;
        max-width: 240px;
        height: 200px;
      }
      .gauge .label {
        font-size: 10px;
      }
      .gauge .water {
        font-size: 18px;
      }
      .status {
        font-size: 12px;
      }
      .status .dot {
        width: 10px;
        height: 10px;
      }
      button {
        padding: 8px 10px;
        font-size: 12px;
      }
      .download-card {
        padding: 10px;
      }
      .file-name {
        font-size: 12px;
      }
      .file-desc {
        font-size: 12px;
      }
      .badge {
        font-size: 10px;
        padding: 3px 6px;
      }
      .tiny {
        font-size: 11px;
      }
      pre {
        font-size: 11px;
        padding: 12px;
        line-height: 1.2em;
      }
      .feature h3 {
        font-size: 15px;
      }
      .feature p {
        font-size: 13px;
      }
      ul, ol {
        font-size: 13px;
        padding-left: 16px;
      }
      li {
        margin-bottom: 6px;
      }
      .download-card:hover {
        transform: translateY(-2px);
      }
      figure img:hover {
        transform: translateY(-2px);
      }
    }

    /* Touch-friendly adjustments */
    @media (hover: none) and (pointer: coarse) {
      .btn {
        padding: 12px 16px;
        min-height: 44px;
      }
      .download-card {
        padding: 16px;
        min-height: 60px;
      }
      .feature {
        padding: 18px;
      }
      button {
        padding: 10px 16px;
        min-height: 44px;
      }
    }
  </style>
</head>
<body>

<header>
  <h1>Flood Detector</h1>
  <p>Arduino + Ultrasonic Sensor + LCD + Buzzer</p>
</header>

<div class="container">
  <div class="hero-card" role="region" aria-label="Live preview">
    <div class="hero-left">
      <h2 style="margin:0 0 6px 0;">Live Preview</h2>
      <p style="margin:0 0 10px 0;color:#23475b">Simulated water-level preview. This visual helps you understand what your sensor+Arduino will report; the blue gauge animates and flips to an alert state when level is high.</p>

      <div class="status" id="statusRow" style="margin-top:12px">
        <div class="dot" aria-hidden="true"></div>
        <div id="statusText">Status: Normal</div>
      </div>
      <div style="margin-top:12px;display:flex;gap:8px;align-items:center">
        <button id="randomBtn" style="padding:8px 12px;border-radius:8px;border:0;background:#0077cc;color:#fff;cursor:pointer">Randomize</button>
        <button id="alertBtn" style="padding:8px 12px;border-radius:8px;border:0;background:#ff6b5f;color:#fff;cursor:pointer">Trigger Alert</button>
        <small style="color:#556068">(Demo controls)</small>
      </div>
    </div>

    <div class="hero-right">
      <div class="gauge" role="img" aria-label="Water level gauge">
        <div class="label">Water</div>
        <div class="water" id="water" style="--level:30%">30%</div>
      </div>
    </div>
  </div>

  <section>
    <h2>About the Project</h2>
    <p>
      This project uses an ultrasonic sensor to measure water levels, displays them on an LCD,
      and triggers a buzzer alert when flooding is detected. It‚Äôs a practical safety tool
      designed with clarity and user-friendly alerts.
    </p>
  </section>


<section>
  <h2>Complete Arduino Code</h2>
  <pre>
#include &lt;Wire.h&gt;
#include &lt;LiquidCrystal_I2C.h&gt;

LiquidCrystal_I2C lcd(0x27, 16, 2); // I2C LCD address and size

const int trigPin = 9;     // Trig ‚Üí D9
const int echoPin = 10;    // Echo ‚Üí D10
const int buzzerPin = 8;   // Buzzer ‚Üí D8

const int maxDepth = 100;      // distance from sensor to bottom
const int floodThreshold = 10; // ALERT if distance &lt;= 10 cm

int prevWaterLevel = -1; // start with invalid value to force first update

// Custom characters
byte upArrow[8] = {
  0b00100, 0b01110, 0b10101, 0b00100,
  0b00100, 0b00100, 0b00100, 0b00000
};

byte downArrow[8] = {
  0b00100, 0b00100, 0b00100, 0b00100,
  0b10101, 0b01110, 0b00100, 0b00000
};

byte equalSign[8] = {
  0b00000, 0b11111, 0b00000, 0b11111,
  0b00000, 0b00000, 0b00000, 0b00000
};

void setup() {
  pinMode(trigPin, OUTPUT);
  pinMode(echoPin, INPUT);
  pinMode(buzzerPin, OUTPUT);

  lcd.init();
  lcd.backlight();

  lcd.createChar(0, upArrow);
  lcd.createChar(1, downArrow);
  lcd.createChar(2, equalSign);

  lcd.setCursor(0,0);
  lcd.print("Flood Detector");
  delay(2000);
  lcd.clear();
}

long getDistance() {
  long sum = 0;
  for (int i = 0; i &lt; 5; i++) {
    digitalWrite(trigPin, LOW);
    delayMicroseconds(2);
    digitalWrite(trigPin, HIGH);
    delayMicroseconds(10);
    digitalWrite(trigPin, LOW);

    long duration = pulseIn(echoPin, HIGH, 20000); // 20ms timeout
    long distance = duration * 0.034 / 2; // cm
    sum += distance;
    delay(10);
  }
  return sum / 5; // average
}

void loop() {
  long distance = getDistance();
  int waterLevel = maxDepth - distance;

  // Clear rows before writing new values
  lcd.setCursor(0,0);
  lcd.print("Water Level:   ");
  lcd.setCursor(0,1);
  lcd.print("                ");

  if (distance &lt;= 30) {
    lcd.setCursor(0,0);
    lcd.print("Water Level:");

    lcd.setCursor(0,1);
    lcd.print(waterLevel);
    lcd.print(" cm ");

    if (distance &lt;= floodThreshold) {
      lcd.print("ALERT ");
    }

    if (prevWaterLevel != -1) {
      if (waterLevel > prevWaterLevel) {
        lcd.write(byte(0)); // Up arrow
      } else if (waterLevel < prevWaterLevel) {
        lcd.write(byte(1)); // Down arrow
      } else {
        lcd.write(byte(2)); // Equal sign
      }
    }
  }

  // Buzzer logic: intermittent beep if flood
  if (distance &lt;= floodThreshold) {
    tone(buzzerPin, 1000); // 1kHz tone
    delay(200);
    noTone(buzzerPin);
    delay(200);
  } else {
    noTone(buzzerPin);
    delay(1000);
  }

  prevWaterLevel = waterLevel;
}
  </pre>
</section>

<section>
  <h2>Code Explanation</h2>
  <h3>Key Parameters</h3>
  <ul>
    <li><strong>maxDepth = 100 cm:</strong> Maximum water depth your sensor can detect (adjust based on your tank size).</li>
    <li><strong>floodThreshold = 10 cm:</strong> Water level at which the alert triggers. When detected distance ‚â§ 10 cm, buzzer sounds.</li>
    <li><strong>I2C Address 0x27:</strong> Standard address for 16x2 LCD modules. If your LCD doesn't respond, use an I2C scanner to find the correct address.</li>
  </ul>

  <h3>How It Works</h3>
  <div style="background:#f0f7ff;padding:16px;border-radius:8px;border-left:4px solid #0077cc;margin-top:12px;">
    <p><strong>1. Sensor Reading (getDistance)</strong><br/>
    Sends an ultrasonic pulse and measures the time it takes to bounce back. Averages 5 readings for stability.</p>
    
    <p><strong>2. Water Level Calculation</strong><br/>
    <code style="background:#222;color:#0f0;padding:4px 8px;border-radius:4px;">waterLevel = maxDepth - distance</code><br/>
    If the sensor is 10 cm above water, distance = 90 cm ‚Üí waterLevel = 10 cm.</p>
    
    <p><strong>3. LCD Display</strong><br/>
    Shows water level in cm with directional arrows (‚Üë rising, ‚Üì falling, = stable) and ALERT text when flooding detected.</p>
    
    <p><strong>4. Buzzer Alert</strong><br/>
    Intermittent beep (200ms on/off) when distance ‚â§ 10 cm. Helps you respond quickly to flooding.</p>
  </div>

  <h3>Custom Characters</h3>
  <p>The LCD displays three custom 5√ó8 pixel characters:</p>
  <ul>
    <li><strong>upArrow (0):</strong> Shows water is rising</li>
    <li><strong>downArrow (1):</strong> Shows water is falling</li>
    <li><strong>equalSign (2):</strong> Shows water level is stable</li>
  </ul>

  <h3>Tuning Tips</h3>
  <ul>
    <li>If buzzer triggers too early/late, adjust <code>floodThreshold</code></li>
    <li>For more stable readings, increase the loop count in <code>getDistance()</code> from 5 to 10</li>
    <li>If LCD doesn't initialize, try 0x3F as the I2C address instead of 0x27</li>
    <li>Sensor placement: Mount ultrasonic sensor pointing downward into the water container</li>
  </ul>
</section>

<section>
  <h2>Setup Guide</h2>
  <ul>
    <li><strong>Wire.h</strong> ‚Äî built into Arduino IDE.</li>
    <li><strong>LiquidCrystal_I2C.h</strong> ‚Äî install via Library Manager or manually.</li>
  </ul>
  <h3>Download Links</h3>
  <div class="download-grid" style="margin-top:12px;">
    <div class="download-card">
      <div class="file-meta">
        <div class="file-name">üìö LiquidCrystal_I2C <span class="badge">official</span></div>
        <div class="file-desc">Official documentation and API reference for the LCD library.</div>
        <div class="tiny">Arduino Docs</div>
      </div>
      <div class="dl-actions">
        <a class="btn" href="https://docs.arduino.cc/libraries/liquidcrystal-i2c" target="_blank" rel="noopener noreferrer">View Docs</a>
      </div>
    </div>

    <div class="download-card">
      <div class="file-meta">
        <div class="file-name">üîó GitHub Repository <span class="badge">source</span></div>
        <div class="file-desc">Source code repository and community contributions for LiquidCrystal_I2C.</div>
        <div class="tiny">GitHub / marcoschwartz</div>
      </div>
      <div class="dl-actions">
        <a class="btn secondary" href="https://github.com/marcoschwartz/LiquidCrystal_I2C" target="_blank" rel="noopener noreferrer">Go to Repo</a>
      </div>
    </div>

    <div class="download-card">
      <div class="file-meta">
        <div class="file-name">‚öôÔ∏è Wire Library Docs <span class="badge">core</span></div>
        <div class="file-desc">Official Arduino Wire library documentation for I2C communication.</div>
        <div class="tiny">Arduino Language Reference</div>
      </div>
      <div class="dl-actions">
        <a class="btn ghost" href="https://docs.arduino.cc/language-reference/en/functions/communication/wire/" target="_blank" rel="noopener noreferrer">Learn More</a>
      </div>
    </div>
  </div>
</section>

<section>
  <h2>Connections</h2>
  <ul>
    
    <li><strong>Ultrasonic Sensor:</strong> VCC ‚Üí 5V, GND ‚Üí GND, TRIG ‚Üí D9, ECHO ‚Üí D10</li>
    <li><strong>LCD (I2C):</strong> VCC ‚Üí 5V, GND ‚Üí GND, SDA ‚Üí A4, SCL ‚Üí A5</li>
    <li><strong>Buzzer:</strong> + ‚Üí D8, ‚Äì ‚Üí GND</li>
  </ul>
</section>

<section>
  <h2>Gallery</h2>
  <p>Here is the actual flood detector circuit setup:</p>
  <div style="display:flex;gap:12px;flex-wrap:wrap;align-items:flex-start">
    <!-- Keep only the single image required by the project -->
    <figure style="margin:0">
      <img src="images/image.png" alt="Flood Detector Wiring (connection image)" style="max-width:720px"/>
      <figcaption style="font-size:13px;color:#556068;margin-top:6px">Wiring / connection image (single reference file)</figcaption>
    </figure>
  </div>
</section>

<section>
  <h2>Downloads</h2>
  <p>You can download the project files below. If the downloads/ copy is missing the page will fall back to the images/ copy.</p>

  <div class="download-grid" id="downloadGrid">
    <div class="download-card">
      <div class="file-meta">
        <div class="file-name">FloodDetector.ino <span class="tiny">(.ino)</span></div>
        <div class="file-desc">Complete Arduino sketch for the Flood Detector.</div>
        <div class="tiny">Estimated: ~8 KB</div>
      </div>
      <div class="dl-actions">
        <!-- Point directly to the .ino file in the root folder (where it is) -->
        <a class="btn" href="FloodDetector.ino" download="FloodDetector.ino" aria-label="Download Arduino sketch">Download</a>
      </div>
    </div>

    <div class="download-card">
      <div class="file-meta">
        <div class="file-name">image.png <span class="tiny">(.png)</span></div>
        <div class="file-desc">Single wiring/connection image used in the Gallery (also the download target).</div>
        <div class="tiny">Image: reference wiring</div>
      </div>
      <div class="dl-actions">
        <!-- Point directly to images/image.png (the file that exists) -->
        <a class="btn secondary" href="images/image.png" download="image.png" aria-label="Download wiring image">Download</a>
      </div>
    </div>
  </div>
</section>

<section>
  <h2>Features</h2>
  <div class="features">
    <div class="feature">
      <h3>üìä LCD Display</h3>
      <p>Shows water level with rising/falling/stable indicators.</p>
    </div>
    <div class="feature">
      <h3>üîî Buzzer Alert</h3>
      <p>Triggers when water level crosses flood threshold.</p>
    </div>
    <div class="feature">
      <h3>‚ö° Smart Logic</h3>
      <p>Custom characters make alerts intuitive and clear.</p>
    </div>
  </div>
</section>

<footer>
  <p>Created by Prateek Priyadarshi | Solo-working coder & founder of <a href="https://testerchip.com/">TesterChip</a></p>
</footer>

<script>
  // Small demo script to animate the gauge and show alert styling.
  (function(){
    const waterEl = document.getElementById('water');
    const statusRow = document.getElementById('statusRow');
    const statusText = document.getElementById('statusText');
    const randomBtn = document.getElementById('randomBtn');
    const alertBtn = document.getElementById('alertBtn');

    function setLevel(percent){
      percent = Math.max(0, Math.min(100, percent));
      waterEl.style.setProperty('--level', percent + '%');
      waterEl.textContent = percent + '%';
      updateStatus(percent);
    }

    function updateStatus(p){
      const threshold = 70; // demo threshold for alert
      if (p >= threshold) {
        statusRow.classList.add('alert');
        statusText.textContent = 'Status: Flood ALERT';
      } else if (p >= 45) {
        statusRow.classList.remove('alert');
        statusText.textContent = 'Status: High';
      } else {
        statusRow.classList.remove('alert');
        statusText.textContent = 'Status: Normal';
      }
    }

    // demo animation loop
    let current = 30;
    setLevel(current);
    let anim = setInterval(()=>{
      current += (Math.random()*14 - 7);
      current = Math.round(current);
      current = Math.max(0, Math.min(100, current));
      setLevel(current);
    }, 2200);

    randomBtn.addEventListener('click', ()=>{
      const r = Math.floor(Math.random()*101);
      setLevel(r);
    });
    alertBtn.addEventListener('click', ()=>{
      setLevel(85);
    });
  })();

  // UI: color the gauge based on percentage and provide quick download feedback
  (function(){
    const waterEl = document.getElementById('water');
    const gauge = document.querySelector('.gauge');
    function applyGaugeClass(p){
      gauge.classList.remove('alert','high');
      if (p >= 75) gauge.classList.add('alert');
      else if (p >= 50) gauge.classList.add('high');
    }

    // enhance existing setLevel (if previously defined) or wrap current behavior
    const originalSetLevel = window.setLevel;
    window.setLevel = function(percent){
      if (typeof originalSetLevel === 'function') originalSetLevel(percent);
      applyGaugeClass(percent);
    };

    // fallback: if demo didn't expose setLevel, hook into interval update by observing text changes
    const observer = new MutationObserver(muts=>{
      muts.forEach(m=>{
        if (m.target === waterEl) {
          const txt = (m.target.textContent||'').replace('%','').trim();
          const val = parseInt(txt,10);
          if (!isNaN(val)) applyGaugeClass(val);
        }
      });
    });
    observer.observe(waterEl,{ characterData:true, subtree:true, childList:true });

    // small click feedback for download buttons
    document.querySelectorAll('.download-grid a[download]').forEach(a=>{
      a.addEventListener('click', e=>{
        a.style.opacity = 0.7;
        setTimeout(()=> a.style.opacity = 1, 400);
      });
    });
  })();

  // Download handler: simple, direct browser download (no fetch for local files)
  (function(){
    document.querySelectorAll('.download-grid a[download]').forEach(a=>{
      a.addEventListener('click', (e)=>{
        // Let the browser handle the download naturally; don't prevent default
        e.style.opacity = 0.7;
        setTimeout(()=> e.style.opacity = 1, 400);
      });
    });
  })();
</script>
</body>

</html>
